<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>INDRA DepMap Explainer</title>

  <!-- JS libraries -->
  <!-- JQ -->
  <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
  <!-- BS 4.1.3 -->
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
  
  <!-- Links -->
  <!-- BS 4.1.3 css -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">

  <!-- custom scripts -->
  <script type="text/javascript">
    var SUBMIT_URL = 'http://localhost:5000/query/submit'

    function submitQuery() {
      var statusBox = document.getElementById('query-status')
      let queryDict = {
        source: document.getElementById('source').value,
        target: document.getElementById('target').value,
        path_length: document.getElementById('path-length').value,
        spec_len_only: document.getElementById('selected-length-only').checked,
        sign: document.getElementById('sign-dd').value,
        weighted: document.getElementById('weighted-search').checked,
        direct_only: document.getElementById('direct-only').checked,
        curated_db_only: document.getElementById('curated-db-only').checked
      }
      let _url = SUBMIT_URL
      statusBox.textContent = 'Query submitted...'
      let response = $.ajax({
        url: _url,
        type: 'POST',
        dataType: 'json',
        contentType: 'application/json',
        data: JSON.stringify(queryDict),
        complete: function(xhr, statustText) {
          switch (xhr.status) {
            case 200:
              statusBox.textContent = 'Query resolved!';
              break;
            default:
              console.log('Submission error: check ajax response');
              statusBox.textContent = 'Submission error:' + xhr.status;
              break;
          }
        }

      })
      console.log(response)
      response.then(function(json){
        fillResultsTable(json)
      })
    }

    function fillResultsTable(data){
      console.log(data)
      var statusBox = document.getElementById('query-status')
      if (data.result.length > 0) {
        let tableBody = document.getElementById('query-results')
        tableBody.innerHTML = null;
        let pathsList = data.result;
        for (path of pathsList) {
          let newRow = document.createElement('tr');
          let newPath = document.createElement('td');
          newPath.textContent = path.path.join('-');
          newRow.appendChild(newPath)
          tableBody.appendChild(newRow);
        }
      } else {
        statusBox.textContent = 'No path found!'
      }
    }

    // Function to put stmts from path in a HTML format with linkouts
    // function generatePathLinkout(path) {
    //   return [];  // NOT DONE HERE!!
    // }

  </script>
</head>
<body>
  <div class="container">
    <h1 class="display-5" style="padding-top: 15px; padding-bottom: 15px;">INDRA Gene Dependency Explainer 2.0</h1>
  </div>
  <div class="container">
    <h2 class="display-6">Enter search</h2>
    <form>
      <div class="row">
        <div class="col">
          <input type="text" id="source" class="form-control" placeholder="Enter source">
        </div>
        <div class="col">
          <input type="text" id="target" class="form-control" placeholder="Enter target">
        </div>
      </div>
      <div class="custom-control custom-checkbox">
        <input type="checkbox" class="custom-control-input" id="weighted-search">
        <label class="custom-control-label" for="weighted-search">Weighted search</label>
      </div>
      <div class="custom-control custom-checkbox">
        <input type="checkbox" class="custom-control-input" id="direct-only">
        <label class="custom-control-label" for="direct-only">Direct only</label>
      </div>
      <div class="custom-control custom-checkbox">
        <input type="checkbox" class="custom-control-input" id="curated-db-only">
        <label class="custom-control-label" for="curated-db-only">Curated databases only</label>
      </div>
      <div class="row" style="padding-top: 5px;">
        <div class="dropdown" style="padding-left: 15px; padding-right: 15px;">
          <select id="path-length">
            <option value="" selected="selected" disabled="disabled" hidden="hidden">Path length</option>
            <option value=1>1</option>
            <option selected="selected" value=2>2</option>
            <option value=3>3</option>
            <option value=4>4</option>
            <option value=5>5</option>
            <option value="no_limit">No Limit</option>
          </select>
        </div>
        <div class="custom-control custom-checkbox">
          <input type="checkbox" class="custom-control-input" id="selected-length-only">
          <label class="custom-control-label" for="selected-length-only">Check for selected length only</label>
        </div>
      </div>
      <div class="row" style="padding-top: 5px;">
        <div class="dropdown" style="padding-left: 15px; padding-right: 15px;">
          <label><select id="sign-dd">
            <option selected="selected" value="no_sign">No sign</option>
            <option value="plus">+</option>
            <option value="minus">-</option>
          </select>&nbsp;&nbsp;Sign</label>
        </div>
      </div>
      <button style="margin-top: 16px; margin-bottom: 16px" type="button" class="btn btn-primary" onclick="submitQuery()">Submit query</button>
    </form>
  </div>
  <div class="container">
    <p><i id="query-status">status</i></p>
  </div>

  <div class="container">
    <h2 class="display-6">Search Results</h2>
    <table class="table">
      <thead class="table-head">
        <th>Path</th>
      </thead>
      <tbody class="table-body" id="query-results"></tbody>
    </table>
  </div>

  <footer class="footer text-muted" id="about" style="background: #F5F5F5;">
    <div class="container">
      <h5 class="my-0 mr-md-auto font-weight-normal">About</h5>
      <small>
        <p class="float-right">
          <a href="#">Back to top</a>
        </p>
        <p><a href="https://indralab.github.io">INDRALAB</a></p>
        <p><a href="http://hits.harvard.edu">Harvard Program in Therapeutic Science (HiTS)</a></p>
        <p><b>Automated Scientific Discovery Framework</b>(ASDF)<br>The DARPA ASDF project develops algorithms and software for reasoning about complex mechanisms operating in the natural world, explaining large-scale data, assisting humans in generating actionable, model-based hypotheses and testing these hypotheses empirically.<br><i>ASDF is funded by the Defense Advanced Research Projects Agency under award W911NF018-1-0124.</i></p>
      </small>
    </div>
  </footer>
</body>
</html>
